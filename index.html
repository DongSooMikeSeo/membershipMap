<!doctype html>
<html>
    <head>
 <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
   integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
   crossorigin=""/>

 <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
   integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
   crossorigin=""></script>


    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css" integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ==" crossorigin="" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.3.0/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.3.0/dist/MarkerCluster.Default.css" />
  
    <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js" integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw==" crossorigin=""></script>
    <script src="https://unpkg.com/leaflet.markercluster@1.3.0/dist/leaflet.markercluster.js"></script>
  

   <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
   <link rel="shortcut icon" href="#" />
    </head>
<body>


    <div id="map" style="height: 100vh; width: 100%;"> </div>

    <script>


 opensheet = '<a href="https://benborgers.com/posts/google-sheets-json">opensheet</a>';

    var mapboxAccessToken = 'pk.eyJ1IjoiZmlyZWRpcmVjdGlvbiIsImEiOiJjanhwZDlndXQwZ2lkM2VwNHIzZGpzMGpjIn0.a9d87Xax3Me_0SdEj8eAeQ';
    var map = L.map('map').setView([37.8, -96], 5.4);
    
    L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=' + mapboxAccessToken, {
        id: 'mapbox/light-v9',
        attribution: opensheet + ' contributors',
        tileSize: 512,
        zoomOffset: -1
    }).addTo(map);
    
    function style() {
    return {
        fillColor: '#800026',
        weight: 2,
        opacity: 1,
        color: 'white',
        dashArray: '3',
        fillOpacity: 0.3
    };
}




    var statesLayer = L.geoJSON(null, {
            style: style,
            // onEachFeature: onEachFeature

        }).addTo(map);

   
    $.getJSON("./assets/gz_2010_us_040_00_500k.json", function(data) {
  
    statesLayer.addData(data);


});


async function main (){ 
   const response = await fetch(
"https://opensheet.elk.sh/1Vl3u7MN8JIO3LtxUZWHMeqRtdR4ftqswGxVhc1R4vQs/Sheet1"
 );
    const json = await response.json();

    const locations = json.filter( x =>x.coopType =="producer").map((row) => {
        return [row.Name, row.Link, row.X, row.Y,row.coopType];
    });

    let markers = L.markerClusterGroup();

for (var i = 0; i < locations.length; i++) {
    popupText = '<a href="'+ locations[i][1]+ '">'+locations[i][0]+'</a>'
    marker = new L.marker([locations[i][2], locations[i][3]])
    .bindPopup(popupText);
    markers.addLayer(marker);

   
};
map.addLayer(markers);

// const workercoopLocations =json.filter( x =>x.coopType =="worker").map((row) => {
//         return [row.Name, row.Link, row.X, row.Y,row.coopType];
//     });

 

}

main();


//https://stackoverflow.com/questions/2722159/how-to-filter-object-array-based-on-attributes

// <div class="btn-group">
//         <button type="button" id="allbus" class="btn btn-success">All</button>
//         <button type="button" id="others" class="btn btn-primary">Others</button>
//         <button type="button" id="cafes" class="btn btn-danger">Cafes</button>
//     </div>


// var promise = $.getJSON("businesses.json");
//     promise.then(function(data) {
//         var allbusinesses = L.geoJson(data);
//                 var cafes = L.geoJson(data, {
//             filter: function(feature, layer) {
//                 return feature.properties.BusType == "Cafe";
//             },
//             pointToLayer: function(feature, latlng) {
//                 return L.marker(latlng, {
//                     icon: cafeIcon
//                 }).on('mouseover', function() {
//                     this.bindPopup(feature.properties.Name).openPopup();
//                 });
//             }
//         });
//         var others = L.geoJson(data, {
//             filter: function(feature, layer) {
//                 return feature.properties.BusType != "Cafe";
//             },
//             pointToLayer: function(feature, latlng) {
//                 return L.marker(latlng, {
//                 }).on('mouseover', function() {
//                     this.bindPopup(feature.properties.Name).openPopup();
//                 });
//             }
//         });
//         map.fitBounds(allbusinesses.getBounds(), {
//             padding: [50, 50]
//         });
//         cafes.addTo(map)
//         others.addTo(map)
//         // The JavaScript below is new
//         $("#others").click(function() {
//             map.addLayer(others)
//             map.removeLayer(cafes)
//         });
//         $("#cafes").click(function() {
//             map.addLayer(cafes)
//             map.removeLayer(others)
//         });
//         $("#allbus").click(function() {
//             map.addLayer(cafes)
//             map.addLayer(others)
//         });
//     });

// //http://bl.ocks.org/zross/47760925fcb1643b4225

    </script>






    
</body>
</html>